<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"   
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <ui:component>
        <p:panel closable="false" collapsed="false">
            <f:facet name="heading">
                <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                    <p:outputLabel value="Suspicious Case Letters" styleClass="panel-title-css"/>
                </b:panelGrid>
            </f:facet>
            <p:dataTable  value="#{sharedBean.entity.letters}" var="letter" paginator="true" paginatorAlwaysVisible="false" reflow="true" rows="10">
                <p:column headerText="Created By" styleClass="large">
                    <h:outputText value="#{letter.createdBy}"/>
                </p:column>
                <p:column headerText="Created Date" styleClass="large">
                    <h:outputText value="#{letter.createdDate}">
                        <f:convertDateTime pattern="dd MMM yyyy"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Letter Head">
                    <h:outputText value="#{letter.letterHead}"/>
                </p:column>
                <p:column headerText="Action" styleClass="xlarge">
                    <p:commandButton styleClass="ui-button-success btn-size-sm"  action="#{sharedBean.updateLetter(letter)}" value="View"  update="@form"/>
                    <p:spacer width="5px"/>
                    <p:commandButton disabled="#{letter.createdBy ne sharedBean.activeUser.sid}" styleClass="ui-button-raised ui-button-danger btn-size-sm" process="@form" update="@(form :not(.noupdate))" immediate="true" action="#{sharedBean.removeLetter(letter)}"  value="Del"/> 
                    <p:spacer width="5px"/>
                    <p:commandButton disabled="#{letter.approve eq 'NO'}" styleClass="ui-button-primary btn-size-sm" icon="fa fa-fw fa-download"  ajax="false" actionListener="#{sharedBean.downloadLetter(letter)}" immediate="true"  update="templateForm">
                        <p:fileDownload value="#{sharedBean.downloadLetter}"/>
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </p:panel>
        <p:spacer width="8px"/>
        <p:panel closable="false" collapsed="false">
            <p:outputPanel id="createLetter" >
                <p:fieldset  legend="Letter Head">
                    <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                        <b:formGroup>
                            <p:selectOneMenu value="#{sharedBean.fieldLetter.letterHead}"  converter="entityConverter">
                                <p:ajax event="change" listener="#{sharedBean.letterTypeSelection}" update="letterTab"/>
                                <f:selectItem itemLabel="Select One"  noSelectionOption="true"/>
                                <f:selectItems value="#{sharedBean.letterHeads}" var="letterHead" itemLabel="#{letterHead.toString()}" itemValue="#{letterHead}"/>
                            </p:selectOneMenu>
                        </b:formGroup>
                    </b:panelGrid>
                </p:fieldset>
                <p:separator/>
                <p:outputPanel id="letterTab" >
                    <p:fieldset  legend="Details">
                        <b:panelGrid colSpans="6,6" size="lg" styleClass="ui-fluid">
                            <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                <b:formGroup>
                                    <p:outputLabel value="Name"/>
                                    <b:inputText readonly="true" value="#{sharedBean.fieldLetter.user.fullNames}" field-size="lg"/>
                                </b:formGroup>
                                <b:formGroup>
                                    <p:outputLabel value="Tel"/>
                                    <b:inputText readonly="true" value="#{sharedBean.fieldLetter.user.workTelephoneNumber}" field-size="lg"/>
                                </b:formGroup>
                                <b:formGroup>
                                    <p:outputLabel value="Email"/>
                                    <b:inputText readonly="true" value="#{sharedBean.fieldLetter.user.emailAddress}" field-size="lg"/>
                                </b:formGroup>
                            </b:panelGrid>
                            <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                <b:formGroup>
                                    <p:outputLabel value="Customs Code"/>
                                    <b:inputText readonly="true" value="#{sharedBean.entity.ibrData.ibrCustomsNumber}" field-size="lg"/>
                                </b:formGroup>
                                <b:formGroup>
                                    <p:outputLabel value="Case Number"/>
                                    <b:inputText readonly="true" value="#{sharedBean.entity.caseRefNumber}" field-size="lg"/>
                                </b:formGroup>
                                <b:formGroup>
                                    <p:outputLabel value="Issue Date"/>
                                    <p:datePicker pattern="dd MMM yyyy" value="#{sharedBean.fieldLetter.issueDate}"/>
                                </b:formGroup>
                                <p:spacer height="5px"/>
                            </b:panelGrid>
                        </b:panelGrid>
                    </p:fieldset>
                    <p:separator/>
                    <p:fieldset  legend="Client Address Details">
                        <b:panelGrid colSpans="6,6" size="lg" styleClass="ui-fluid">
                            <b:formGroup >
                                <p:outputLabel value="Client Name"/>
                                <b:inputText value="#{sharedBean.entity.ibrData.registrationName}" field-size="lg"/>
                            </b:formGroup>
                            <b:formGroup >
                                <p:outputLabel value="Address line 1"/>
                                <b:inputText value="#{sharedBean.entity.ibrData.postalAddress}" field-size="lg"/>
                            </b:formGroup>
                            <b:formGroup>
                                <p:outputLabel value="Address line 2"/>
                                <b:inputText value="#{sharedBean.fieldLetter.address.line2}" field-size="lg"/>
                            </b:formGroup>
                            <b:formGroup>
                                <p:outputLabel value="Address line 3"/>
                                <b:inputText value="#{sharedBean.fieldLetter.address.line3}" field-size="lg"/>
                            </b:formGroup>
                            <b:formGroup>
                                <p:outputLabel value="Postal Code"/>
                                <b:inputText value="#{sharedBean.fieldLetter.address.code}" field-size="lg"/>
                            </b:formGroup>
                        </b:panelGrid>
                    </p:fieldset>
                    <p:separator/>
                    <p:fieldset  legend="Body of Letter">
                        <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                            <b:formGroup>
                                <p:outputLabel value="Salutation"/>
                                <p:selectOneMenu value="#{sharedBean.fieldLetter.salutation}" converter="entityConverter">
                                    <f:selectItem itemLabel="Select One"  noSelectionOption="true"/>
                                    <f:selectItems value="#{sharedBean.salutations}" var="salutation" itemLabel="#{salutation.toString()}" itemValue="#{salutation}"/>
                                </p:selectOneMenu>
                            </b:formGroup>
                            <b:formGroup rendered="#{sharedBean.isReqDocLetterDetails  or sharedBean.isAuditPlanLetterDetails or sharedBean.isSelectedLof}">
                                <p:outputLabel value="Trading Name"/>
                                <b:inputText value="#{sharedBean.entity.ibrData.registrationName}" field-size="lg"/>
                            </b:formGroup>
                            <b:formGroup rendered="#{sharedBean.isAuditPlanLetterDetails}">
                                <p:outputLabel value="Audit Type"/>
                                <b:inputText value="#{sharedBean.entity.auditPlan.auditType}" field-size="lg"/>
                            </b:formGroup>
                            <b:formGroup rendered="#{sharedBean.isSelectedFoa}">
                                <p:outputLabel value="Audit Period"/>
                                <p:datePicker pattern="dd MMM yyyy"  selectionMode="range" value="#{sharedBean.entity.auditPlan.auditPeriod}"/>
                            </b:formGroup>
                            <p:outputPanel rendered="#{sharedBean.isSelectedLod or sharedBean.isSelectedIop}">
                                <p:spacer width="5"/>
                                <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                    <b:formGroup>
                                        <p:outputLabel value="Notice of Intent Date"/>
                                        <p:datePicker pattern="dd MMM yyyy" value="#{sharedBean.fieldLetter.noticeOfIntentDate}"/>
                                    </b:formGroup>
                                </b:panelGrid>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedLod or sharedBean.isSelectedIop}">
                                <p:spacer width="5"/>
                                <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                    <b:formGroup >
                                        <p:outputLabel value="Representation Date"/>
                                        <p:datePicker pattern="dd MMM yyyy" value="#{sharedBean.fieldLetter.representationDate}"/>
                                    </b:formGroup>
                                </b:panelGrid>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedIop}">
                                <p:spacer width="5"/>
                                <b:formGroup>
                                    <p:outputLabel value="Pay Fully or Partially"/>
                                    <b:selectOneMenu value="#{sharedBean.fieldLetter.partiallyPayment}" required="true" requiredMessage="Please select Partial Payments" converter="entityConverter">
                                        <f:selectItem itemLabel="Select One"  noSelectionOption="true"/>
                                        <f:selectItems value="#{sharedBean.paymentTypes}" var="partial" itemLabel="#{paymentType.toString()}" itemValue="#{paymentType}"/>
                                    </b:selectOneMenu>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedIop or sharedBean.isSelectedLod or sharedBean.isSelectedNoi}">
                                <b:formGroup >
                                    <ui:repeat  value="#{sharedBean.entity.auditPlan.auditReport.auditReportOffencePenalties}" var="totala" varStatus="entityVarStatus">
                                        <p:outputLabel value="Total A"/>
                                        <b:inputText value="#{totala.offenceAndPenalty.subOffenceOrPenaltyAmount}" field-size="lg"/>
                                    </ui:repeat>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedLod}">
                                <p:spacer width="5"/>
                                <b:formGroup >
                                    <p:outputLabel value="Additional Explanation"/>
                                    <b:inputTextarea value="#{sharedBean.fieldLetter.additionalExplanation}" field-size="lg"/>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedNoi}">
                                <p:spacer width="5"/>
                                <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                    <b:formGroup >
                                        <p:outputLabel value="Notification of Audit"/>
                                        <p:datePicker pattern="dd MMM yyyy" value="#{sharedBean.fieldLetter.notificationOfAuditDate}"/>
                                    </b:formGroup>
                                </b:panelGrid>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedLof or sharedBean.isSelectedNoi}">
                                <b:formGroup>
                                    <p:outputLabel value="Total VAT Due"/>
                                    <b:inputText value="#{sharedBean.entity.auditPlan.auditReport.totalLiability.totalVat}" field-size="lg"/>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedLof}">
                                <b:formGroup>
                                    <ui:repeat  value="#{sharedBean.fieldLetter.dutyVats}" var="totalb" varStatus="entityVarStatus">
                                        <p:outputLabel value="Total B"/>
                                        <b:inputText value="#{totalb.subAmount}" field-size="lg"/><!-- comment -->
                                    </ui:repeat>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isAuditPlanLetterDetails}">
                                <p:spacer width="5"/>
                                <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                    <b:formGroup >
                                        <p:outputLabel value="Field Date"/>
                                        <p:datePicker pattern="dd MMM yyyy" value="#{sharedBean.entity.auditPlan.startDate}"/>
                                    </b:formGroup>
                                </b:panelGrid>
                            </p:outputPanel>
                            <p:spacer width="5"/>
                            <p:outputPanel rendered="#{sharedBean.isSelectedNoi}">
                                <b:formGroup>
                                    <p:outputLabel value="Action or Circumstance of contravention detection"/>
                                    <p:inputTextarea value="#{sharedBean.fieldLetter.circumstanceOfContravention}" rows="8" cols="50" maxlength="1000"/>                                            
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isReqDocLetterDetails or sharedBean.isAuditPlanLetterDetails or sharedBean.isSelectedNoi or sharedBean.isSelectedLod or  sharedBean.isSelectedLof}">
                                <p:spacer width="5"/>
                                <b:formGroup>
                                    <p:outputLabel value="Amount of Days Due"/>
                                    <b:inputText value="#{sharedBean.fieldLetter.daysDue}" field-size="lg"/>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedLod}">
                                <b:formGroup>
                                    <p:outputLabel value="Amount Forfeiture"/>
                                    <b:inputText value="#{sharedBean.entity.auditPlan.auditReport.revenueLiability.forfieture}" field-size="lg"/>
                                </b:formGroup>
                            </p:outputPanel>
                            <p:outputPanel rendered="#{sharedBean.isSelectedNoi or sharedBean.isSelectedLod}">
                                <b:formGroup>
                                    <p:selectBooleanCheckbox itemLabel="Goods dealt with" value="#{sharedBean.fieldLetter.goodsDealt}">
                                    </p:selectBooleanCheckbox>
                                </b:formGroup> 
                            </p:outputPanel>

                        </b:panelGrid>
                    </p:fieldset>
                    <p:separator/>
                    <b:panelGrid colSpans="3,9" size="lg" styleClass="ui-fluid">
                        <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                            <p:fieldset rendered="#{sharedBean.isAuditPlanLetterDetails}" legend="Programs">
                                <p:selectManyCheckbox value="#{sharedBean.fieldLetter.programs}" layout="responsive" columns="1">
                                    <f:selectItems value="#{sharedBean.programs}" var="program" itemLabel="#{program.description}" itemValue="#{program}"/>
                                </p:selectManyCheckbox>
                            </p:fieldset>
                        </b:panelGrid>
                        <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                            <p:fieldset rendered="#{sharedBean.isAuditPlanLetterDetails or sharedBean.isReqDocLetterDetails}" legend="Details of Documentation Required">
                                <p:selectManyCheckbox  value="#{sharedBean.fieldLetter.relevantMaterials}" layout="responsive" columns="3">
                                    <f:selectItems value="#{sharedBean.relevantMaterials}" var="relevantMaterial" itemLabel="#{relevantMaterial.description}" itemValue="#{relevantMaterial}"/>
                                </p:selectManyCheckbox>
                            </p:fieldset>
                        </b:panelGrid>
                    </b:panelGrid>
                    <b:panelGrid rendered="#{sharedBean.isAuditPlanLetterDetails}" colSpans="12" size="lg" styleClass="ui-fluid">
                        <p:fieldset legend="Letter Auditors">
                            <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                                <b:formGroup>
                                    <b:row>
                                        <b:commandButton  icon-size="lg" iconAwesome="fa-plus" process="@this" update="auditorOutputPanel_ID" action="#{sharedBean.addAuditor(sharedBean.fieldLetter)}" large-screen="full-width" look="primary" value="Add" size="lg"/>
                                    </b:row>
                                </b:formGroup>
                                <b:formGroup>
                                    <p:outputPanel id="auditorOutputPanel_ID">
                                        <p:dataTable rendered="#{not empty sharedBean.fieldLetter.auditors}"  value="#{sharedBean.fieldLetter.auditors}" var="auditor" paginator="true" paginatorAlwaysVisible="false" stripedRows="true" reflow="true" rows="10">
                                            <p:column headerText="Auditor Name" styleClass="ui-fluid">
                                                <b:inputText  value="#{auditor.name}"/>
                                            </p:column>
                                            <p:column headerText="Action" styleClass="xmedium">
                                                <p:commandButton disabled="#{auditor.createdBy ne sharedBean.activeUser.sid}" styleClass="ui-button-raised ui-button-danger btn-size-sm" process="@form" update="@form" immediate="true" action="#{sharedBean.removeAuditor(auditor)}"  value="Delete"/> 
                                            </p:column>
                                        </p:dataTable>
                                    </p:outputPanel>
                                </b:formGroup>  
                            </b:panelGrid>
                        </p:fieldset>
                    </b:panelGrid>
                    <b:panelGrid rendered="#{sharedBean.isAuditPlanLetterDetails or sharedBean.isReqDocLetterDetails}" colSpans="12" size="lg" styleClass="ui-fluid">
                        <p:fieldset legend="Customs Declaration">
                            <b:panelGrid colSpans="12" size="lg" styleClass="ui-fluid">
                                <b:formGroup>
                                    <b:row>
                                        <b:commandButton  icon-size="lg" iconAwesome="fa-plus" process="@this" update="declarationOutputPanel_ID" action="#{sharedBean.addCustomDeclaration(sharedBean.fieldLetter)}" large-screen="full-width" look="primary" value="Add" size="lg"/>
                                    </b:row>
                                </b:formGroup>
                                <b:formGroup>
                                    <p:outputPanel id="declarationOutputPanel_ID">
                                        <p:dataTable rendered="#{not empty sharedBean.fieldLetter.declarations}"  value="#{sharedBean.fieldLetter.declarations}" var="declaration" paginator="true" paginatorAlwaysVisible="false" stripedRows="true" reflow="true" rows="10">
                                            <p:column headerText="Description" styleClass="ui-fluid">
                                                <b:inputText  value="#{declaration.description}"/>
                                            </p:column>
                                            <p:column headerText="Action" styleClass="xmedium">
                                                <p:commandButton disabled="#{sharedBean.fieldLetter.createdBy ne sharedBean.activeUser.sid}" styleClass="ui-button-raised ui-button-danger btn-size-sm" process="@form" update="@form" immediate="true" action="#{sharedBean.removeCustomDeclaration(declaration)}"  value="Delete"/> 
                                            </p:column>
                                        </p:dataTable>
                                    </p:outputPanel>
                                </b:formGroup>  
                            </b:panelGrid>
                        </p:fieldset>
                    </b:panelGrid>
                    <p:outputPanel rendered="#{sharedBean.isReqDocLetterDetails or sharedBean.isAuditPlanLetterDetails or sharedBean.isSelectedLod or sharedBean.isSelectedLof or sharedBean.isSelectedNoi or sharedBean.isSelectedIop}">
                        <p:outputPanel rendered="#{sharedBean.isSelectedLof or sharedBean.isSelectedNoi or sharedBean.isSelectedIop}">
                            <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                <p:dataTable value="#{sharedBean.entity.auditPlan.auditReport.auditReportOffencePenalties}"  var="offence" paginator="true" paginatorAlwaysVisible="false" reflow="true" rows="10">
                                    <f:facet name="header">
                                        <f:facet name="right">
                                            <p:outputLabel value="Contravention/ Offence Details" styleClass="panel-title-css"/>
                                        </f:facet>
                                    </f:facet>
                                    <p:column headerText="Section / Rule Contravened">
                                        <h:outputText value="#{offence.offencePenalty.sectionRule.description}" />
                                    </p:column>
                                    <p:column headerText="Circumstance">
                                        <h:outputText value="#{offence.offenceAndPenalty.offenceClassification.description}" />
                                    </p:column>
                                    <p:column headerText="Offence">
                                        <h:outputText value="#{offence.offenceAndPenalty.offenceDescription.description}" />
                                    </p:column>
                                    <p:column headerText="Penalty" rendered="#{sharedBean.isSelectedIop}" >
                                        <h:outputText value="#{offence.offenceAndPenalty.offenceDescription.deposit}"  />
                                    </p:column>
                                    <p:column headerText="Deposit for Possible Penalty" rendered="#{not sharedBean.isSelectedLof and not sharedBean.isSelectedIop}">
                                        <h:outputText value="#{offence.offenceAndPenalty.offenceDescription.deposit}" rendered="#{not sharedBean.isSelectedLof and not sharedBean.isSelectedIop}" />
                                    </p:column>
                                </p:dataTable>
                            </b:panelGrid>
                        </p:outputPanel>
                        <p:spacer width="5px"/>
                        <p:spacer width="5px"/>
                        <p:outputPanel rendered="#{sharedBean.isSelectedLof or sharedBean.isSelectedNoi or sharedBean.isSelectedLod}">
                            <b:panelGrid colSpans="12" styleClass="ui-fluid">
                                <b:formGroup>
                                    <b:row>
                                        <b:commandButton  icon-size="lg" iconAwesome="fa-plus" process="@this" update="dutyVatOutputPanel_ID" action="#{sharedBean.addDutyVat(sharedBean.fieldLetter)}" large-screen="full-width" look="primary" value="Add" size="lg"/>
                                    </b:row>
                                </b:formGroup>
                                <p:outputPanel id="dutyVatOutputPanel_ID">
                                    <b:formGroup>
                                        <p:dataTable   value="#{sharedBean.fieldLetter.dutyVats}" var="dutyVat" paginator="true" paginatorAlwaysVisible="false" reflow="true" rows="10">
                                            <f:facet name="header">
                                                <p:toolbar>
                                                    <f:facet name="right">
                                                        <h:outputLabel value="Duty/VAT" rendered="#{sharedBean.isSelectedLof or createAuditReportingBean.isSelectedNoi}"/>
                                                        <h:outputLabel value="Duties and Taxes Underpaid" rendered="#{sharedBean.isSelectedLod}"/>
                                                    </f:facet>
                                                </p:toolbar>
                                            </f:facet>
                                            <p:column headerText="Declaration Number" rendered="#{createAuditReportingBean.isSelectedLof or createAuditReportingBean.isSelectedNoi}">
                                                <p:inputText value="#{dutyVat.declarationLineNumber}" />
                                            </p:column>
                                            <p:column headerText="Declaration and Line Number" rendered="#{createAuditReportingBean.isSelectedLod}">
                                                <p:inputText value="#{dutyVat.declarationLineNumber} #{dutyVat.lineNumber}" />
                                            </p:column>
                                            <p:column headerText="Line Number" rendered="#{createAuditReportingBean.isSelectedLof or createAuditReportingBean.isSelectedNoi}">
                                                <p:inputText value="#{dutyVat.lineNumber}" />
                                            </p:column>
                                            <p:column headerText="Type of Duty or Tax Underpaid">
                                                <p:inputText value="#{dutyVat.typeOfDuty}" />
                                            </p:column>
                                            <p:column headerText="Amount">
                                                <p:inputText value="#{dutyVat.amount}" />
                                            </p:column>
                                            <p:column headerText="Action" styleClass="xmedium">
                                                <p:commandButton disabled="#{sharedBean.fieldLetter.createdBy ne sharedBean.activeUser.sid}" styleClass="ui-button-raised ui-button-danger btn-size-sm" process="@form" update="@form" immediate="true" action="#{sharedBean.removeDutyVat(dutyVat)}"  value="Delete"/> 
                                            </p:column>
                                        </p:dataTable>
                                    </b:formGroup>
                                </p:outputPanel>
                            </b:panelGrid>
                        </p:outputPanel>
                    </p:outputPanel>
                </p:outputPanel>
            </p:outputPanel>
            <f:facet name="footer">
                <b:row styleClass="ui-fluid">
                    <p:commandButton styleClass="ui-button-raised ui-button-primary btn-size-lg"  update="@(.ui-datatable)" action="#{sharedBean.addLetter(sharedBean.fieldLetter)}" value="Add Letter"/>
                </b:row>
            </f:facet> 
        </p:panel>
    </ui:component>
</html>
